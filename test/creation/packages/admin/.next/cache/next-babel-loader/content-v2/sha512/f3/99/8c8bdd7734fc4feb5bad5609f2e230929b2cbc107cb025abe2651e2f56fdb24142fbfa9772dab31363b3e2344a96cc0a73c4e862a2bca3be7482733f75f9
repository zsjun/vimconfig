{"ast":null,"code":"import \"antd/lib/modal/style\";\nimport _Modal from \"antd/lib/modal\";\nimport \"antd/lib/spin/style\";\nimport _Spin from \"antd/lib/spin\";\nimport _extends from \"/Users/zsj/work/vimconfig/test/creation/packages/admin/node_modules/@babel/runtime/helpers/esm/extends\";\nimport \"antd/lib/popconfirm/style\";\nimport _Popconfirm from \"antd/lib/popconfirm\";\nimport \"antd/lib/divider/style\";\nimport _Divider from \"antd/lib/divider\";\nimport \"antd/lib/button/style\";\nimport _Button from \"antd/lib/button\";\nimport \"antd/lib/message/style\";\nimport _message from \"antd/lib/message\";\nimport _defineProperty from \"/Users/zsj/work/vimconfig/test/creation/packages/admin/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport _objectWithoutProperties from \"/Users/zsj/work/vimconfig/test/creation/packages/admin/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties\";\nimport _slicedToArray from \"/Users/zsj/work/vimconfig/test/creation/packages/admin/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nimport \"antd/lib/tag/style\";\nimport _Tag from \"antd/lib/tag\";\nimport \"antd/lib/badge/style\";\nimport _Badge from \"antd/lib/badge\";\nimport \"antd/lib/select/style\";\nimport _Select from \"antd/lib/select\";\nvar __jsx = React.createElement;\nimport React, { useState, useCallback, useEffect } from 'react';\nimport Link from 'next/link';\nimport { PlusOutlined } from '@ant-design/icons';\nimport { getRandomColor } from '@/constants';\nimport { resolveUrl } from '@/utils';\nimport { useAsyncLoading } from '@/hooks/useAsyncLoading';\nimport { usePagination } from '@/hooks/usePagination';\nimport { useSetting } from '@/hooks/useSetting';\nimport { useToggle } from '@/hooks/useToggle';\nimport { AdminLayout } from '@/layout/AdminLayout';\nimport { ArticleProvider } from '@/providers/article';\nimport { ViewProvider } from '@/providers/view';\nimport { CategoryProvider } from '@/providers/category';\nimport { ViewChart } from '@/components/ViewChart';\nimport { PaginationTable } from '@/components/PaginationTable';\nimport { LocaleTime } from '@/components/LocaleTime';\nimport style from './index.module.scss';\nvar updateLoadingMessage = null;\nvar SCROLL = {\n  x: 1380\n};\nvar SEARCH_FIELDS = [{\n  label: '标题',\n  field: 'title',\n  msg: '请输入文章标题'\n}, {\n  label: '状态',\n  field: 'status',\n  children: __jsx(_Select, {\n    style: {\n      width: 180\n    }\n  }, [{\n    label: '已发布',\n    value: 'publish'\n  }, {\n    label: '草稿',\n    value: 'draft'\n  }].map(function (t) {\n    return __jsx(_Select.Option, {\n      key: t.label,\n      value: t.value\n    }, t.label);\n  }))\n}];\nvar COMMON_COLUMNS = [{\n  title: '状态',\n  dataIndex: 'status',\n  width: 100,\n  key: 'status',\n  render: function render(status) {\n    var isDraft = status === 'draft';\n    return __jsx(_Badge, {\n      color: isDraft ? 'gold' : 'green',\n      text: isDraft ? '草稿' : '已发布'\n    });\n  }\n}, {\n  title: '分类',\n  key: 'category',\n  dataIndex: 'category',\n  width: 100,\n  render: function render(category) {\n    return category ? __jsx(\"span\", null, __jsx(_Tag, {\n      color: getRandomColor(category.label),\n      key: category.value\n    }, category.label)) : null;\n  }\n}, {\n  title: '标签',\n  key: 'tags',\n  dataIndex: 'tags',\n  width: 200,\n  render: function render(tags) {\n    return __jsx(\"span\", null, tags.map(function (tag) {\n      return __jsx(_Tag, {\n        color: getRandomColor(tag.label),\n        key: tag.label\n      }, tag.label);\n    }));\n  }\n}, {\n  title: '阅读量',\n  dataIndex: 'views',\n  key: 'views',\n  width: 120,\n  render: function render(views) {\n    return __jsx(_Badge, {\n      count: views,\n      showZero: true,\n      overflowCount: Infinity,\n      style: {\n        backgroundColor: '#52c41a'\n      }\n    });\n  }\n}, {\n  title: '喜欢数',\n  dataIndex: 'likes',\n  key: 'likes',\n  width: 120,\n  render: function render(val) {\n    return __jsx(_Badge, {\n      count: val,\n      showZero: true,\n      overflowCount: Infinity,\n      style: {\n        backgroundColor: '#eb2f96'\n      }\n    });\n  }\n}, {\n  title: '发布时间',\n  dataIndex: 'publishAt',\n  key: 'publishAt',\n  width: 200,\n  render: function render(date) {\n    return __jsx(LocaleTime, {\n      date: date\n    });\n  }\n}];\n\nvar Article = function Article() {\n  var setting = useSetting();\n\n  var _useToggle = useToggle(false),\n      _useToggle2 = _slicedToArray(_useToggle, 2),\n      modalVisible = _useToggle2[0],\n      toggleModalVisible = _useToggle2[1];\n\n  var _useState = useState([]),\n      views = _useState[0],\n      setViews = _useState[1];\n\n  var _useState2 = useState([]),\n      categorys = _useState2[0],\n      setCategorys = _useState2[1];\n\n  var _usePagination = usePagination(ArticleProvider.getArticles),\n      listLoading = _usePagination.loading,\n      articles = _usePagination.data,\n      refresh = _usePagination.refresh,\n      resetPagination = _objectWithoutProperties(_usePagination, [\"loading\", \"data\", \"refresh\"]);\n\n  var _useAsyncLoading = useAsyncLoading(ArticleProvider.updateArticle),\n      _useAsyncLoading2 = _slicedToArray(_useAsyncLoading, 2),\n      updateApi = _useAsyncLoading2[0],\n      updateLoading = _useAsyncLoading2[1];\n\n  var _useAsyncLoading3 = useAsyncLoading(ArticleProvider.deleteArticle),\n      _useAsyncLoading4 = _slicedToArray(_useAsyncLoading3, 2),\n      deleteAPi = _useAsyncLoading4[0],\n      deleteLoading = _useAsyncLoading4[1];\n\n  var _useAsyncLoading5 = useAsyncLoading(ViewProvider.getViewsByUrl),\n      _useAsyncLoading6 = _slicedToArray(_useAsyncLoading5, 2),\n      getViewsByUrlApi = _useAsyncLoading6[0],\n      getViewsLoading = _useAsyncLoading6[1];\n\n  var updateAction = useCallback(function (articles, key) {\n    var value = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;\n\n    if (!Array.isArray(articles)) {\n      articles = [articles];\n    }\n\n    return function () {\n      return Promise.all(articles.map(function (article) {\n        return updateApi(article.id, _defineProperty({}, key, value !== null ? value : !article[key]));\n      })).then(function () {\n        _message.success('操作成功');\n\n        refresh();\n      });\n    };\n  }, [updateApi, refresh]);\n  var deleteAction = useCallback(function (ids) {\n    var resetSelectedRows = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;\n\n    if (!Array.isArray(ids)) {\n      ids = [ids];\n    }\n\n    return function () {\n      Promise.all(ids.map(function (id) {\n        return deleteAPi(id);\n      })).then(function () {\n        _message.success('操作成功');\n\n        refresh();\n        resetSelectedRows && resetSelectedRows();\n      });\n    };\n  }, [deleteAPi, refresh]);\n  var getViews = useCallback(function (url) {\n    toggleModalVisible();\n    getViewsByUrlApi(url).then(function (res) {\n      setViews(res);\n    });\n  }, [toggleModalVisible, getViewsByUrlApi]);\n  var closeViewModal = useCallback(function () {\n    toggleModalVisible();\n    setViews([]);\n  }, [toggleModalVisible]);\n  var titleColumn = {\n    title: '标题',\n    dataIndex: 'title',\n    key: 'title',\n    fixed: 'left',\n    width: 200,\n    render: function render(text, record) {\n      return __jsx(\"a\", {\n        href: resolveUrl(setting.systemUrl, \"/article/\".concat(record.id)),\n        target: \"_blank\",\n        rel: \"noreferrer\"\n      }, text);\n    }\n  };\n\n  var actionColumn = function actionColumn(resetSelectedRows) {\n    return {\n      title: '操作',\n      key: 'action',\n      fixed: 'right',\n      render: function render(_, record) {\n        return __jsx(\"span\", {\n          className: style.action\n        }, __jsx(Link, {\n          href: \"/article/editor/[id]\",\n          as: \"/article/editor/\" + record.id\n        }, __jsx(\"a\", null, __jsx(_Button, {\n          type: \"link\",\n          size: 'small'\n        }, \"\\u7F16\\u8F91\"))), __jsx(_Divider, {\n          type: \"vertical\"\n        }), __jsx(_Button, {\n          type: \"link\",\n          size: 'small',\n          onClick: updateAction(record, 'isRecommended')\n        }, record.isRecommended ? '撤销首焦' : '首焦推荐'), __jsx(_Divider, {\n          type: \"vertical\"\n        }), __jsx(_Button, {\n          type: \"link\",\n          size: 'small',\n          onClick: function onClick() {\n            return getViews(resolveUrl(setting.systemUrl, '/article/' + record.id));\n          }\n        }, \"\\u67E5\\u770B\\u8BBF\\u95EE\"), __jsx(_Divider, {\n          type: \"vertical\"\n        }), __jsx(_Popconfirm, {\n          title: \"\\u786E\\u8BA4\\u5220\\u9664\\u8FD9\\u4E2A\\u6587\\u7AE0\\uFF1F\",\n          onConfirm: deleteAction(record.id, resetSelectedRows),\n          okText: \"\\u786E\\u8BA4\",\n          cancelText: \"\\u53D6\\u6D88\",\n          okButtonProps: {\n            loading: deleteLoading\n          }\n        }, __jsx(_Button, {\n          type: \"link\",\n          size: 'small'\n        }, \"\\u5220\\u9664\")));\n      }\n    };\n  };\n\n  useEffect(function () {\n    CategoryProvider.getCategory().then(function (res) {\n      return setCategorys(res);\n    });\n  }, []);\n  useEffect(function () {\n    if (updateLoading) {\n      updateLoadingMessage = _message.loading('操作中...', 0);\n    } else {\n      updateLoadingMessage && updateLoadingMessage();\n    }\n  }, [updateLoading]);\n  return __jsx(AdminLayout, null, __jsx(\"div\", {\n    className: style.wrapper\n  }, __jsx(PaginationTable, _extends({\n    showSelection: true,\n    loading: listLoading,\n    data: articles,\n    columns: function columns(resetSelectedRows) {\n      return [titleColumn].concat(COMMON_COLUMNS, [actionColumn(resetSelectedRows)]);\n    }\n  }, resetPagination, {\n    refresh: refresh,\n    renderLeftNode: function renderLeftNode(_ref) {\n      var hasSelected = _ref.hasSelected,\n          selectedRowKeys = _ref.selectedRowKeys,\n          selectedRows = _ref.selectedRows,\n          resetSelectedRows = _ref.resetSelectedRows;\n      return hasSelected ? __jsx(React.Fragment, null, __jsx(_Button, {\n        disabled: !hasSelected,\n        style: {\n          marginRight: 8\n        },\n        onClick: updateAction(selectedRows, 'status', 'publish')\n      }, \"\\u53D1\\u5E03\"), __jsx(_Button, {\n        disabled: !hasSelected,\n        style: {\n          marginRight: 8\n        },\n        onClick: updateAction(selectedRows, 'status', 'draft')\n      }, \"\\u8349\\u7A3F\"), __jsx(_Button, {\n        disabled: !hasSelected,\n        style: {\n          marginRight: 8\n        },\n        onClick: updateAction(selectedRows, 'isRecommended', true)\n      }, \"\\u9996\\u7126\\u63A8\\u8350\"), __jsx(_Button, {\n        disabled: !hasSelected,\n        style: {\n          marginRight: 8\n        },\n        onClick: updateAction(selectedRows, 'isRecommended', false)\n      }, \"\\u64A4\\u9500\\u9996\\u7126\"), __jsx(_Popconfirm, {\n        title: \"\\u786E\\u8BA4\\u5220\\u9664\\uFF1F\",\n        onConfirm: deleteAction(selectedRowKeys, resetSelectedRows),\n        okText: \"\\u786E\\u8BA4\",\n        cancelText: \"\\u53D6\\u6D88\"\n      }, __jsx(_Button, {\n        disabled: !hasSelected,\n        loading: deleteLoading,\n        danger: true\n      }, \"\\u5220\\u9664\"))) : null;\n    },\n    rightNode: __jsx(Link, {\n      href: '/article/editor'\n    }, __jsx(\"a\", null, __jsx(_Button, {\n      type: \"primary\"\n    }, __jsx(PlusOutlined, null), \"\\u65B0\\u5EFA\"))),\n    scroll: SCROLL,\n    searchFields: [].concat(SEARCH_FIELDS, [{\n      label: '分类',\n      field: 'category',\n      children: __jsx(_Select, {\n        style: {\n          width: 180\n        }\n      }, categorys.map(function (t) {\n        return __jsx(_Select.Option, {\n          key: t.id,\n          value: t.id\n        }, t.label);\n      }))\n    }])\n  })), __jsx(_Modal, {\n    title: \"\\u8BBF\\u95EE\\u7EDF\\u8BA1\",\n    visible: modalVisible,\n    width: 640,\n    onCancel: closeViewModal,\n    maskClosable: false,\n    footer: null,\n    transitionName: '',\n    maskTransitionName: ''\n  }, __jsx(\"div\", {\n    style: {\n      textAlign: 'center'\n    }\n  }, __jsx(_Spin, {\n    spinning: getViewsLoading\n  }, __jsx(ViewChart, {\n    data: views\n  }))))));\n};\n\nexport default Article;","map":null,"metadata":{},"sourceType":"module"}