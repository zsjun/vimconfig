{"ast":null,"code":"import \"antd/lib/row/style\";\nimport _Row from \"antd/lib/row\";\nimport \"antd/lib/card/style\";\nimport _Card from \"antd/lib/card\";\nimport \"antd/lib/button/style\";\nimport _Button from \"antd/lib/button\";\nimport \"antd/lib/input/style\";\nimport _Input from \"antd/lib/input\";\nimport \"antd/lib/avatar/style\";\nimport _Avatar from \"antd/lib/avatar\";\nimport \"antd/lib/col/style\";\nimport _Col from \"antd/lib/col\";\nimport \"antd/lib/list/style\";\nimport _List from \"antd/lib/list\";\nimport \"antd/lib/typography/style\";\nimport _Typography from \"antd/lib/typography\";\nimport \"antd/lib/message/style\";\nimport _message from \"antd/lib/message\";\nimport \"antd/lib/tabs/style\";\nimport _Tabs from \"antd/lib/tabs\";\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport React, { useState, useCallback, useContext } from 'react';\nimport { Form } from '@ant-design/compatible';\nimport { default as Router } from 'next/router';\nimport { AdminLayout } from '@/layout/AdminLayout';\nimport { FileSelectDrawer } from '@/components/FileSelectDrawer';\nimport { ArticleProvider } from '@/providers/article';\nimport { CommentProvider } from '@/providers/comment';\nimport { TagProvider } from '@/providers/tag';\nimport { CategoryProvider } from '@/providers/category';\nimport { FileProvider } from '@/providers/file';\nimport { UserProvider } from '@/providers/user';\nimport { GlobalContext } from '@/context/global';\nimport styles from './index.module.scss';\nconst {\n  TabPane\n} = _Tabs;\n\nconst Ownspace = ({\n  articlesCount = 0,\n  tagsCount = 0,\n  categoryCount = 0,\n  filesCount = 0,\n  commentsCount = 0\n}) => {\n  const data = [`累计发表了 ` + articlesCount + ' 篇文章', `累计创建了 ` + categoryCount + ' 个分类', `累计创建了 ` + tagsCount + ' 个标签', `累计上传了 ` + filesCount + ' 个文件', `累计获得了 ` + commentsCount + ' 个评论'];\n  const globalContext = useContext(GlobalContext);\n  const {\n    0: user,\n    1: setUser\n  } = useState(globalContext.user);\n  const {\n    0: visible,\n    1: setVisible\n  } = useState(false);\n  const {\n    0: oldPassword,\n    1: setOldPassword\n  } = useState(null);\n  const {\n    0: newPassword1,\n    1: setNewPassword1\n  } = useState(null);\n  const {\n    0: newPassword2,\n    1: setNewPassword2\n  } = useState(null);\n  const save = useCallback(() => {\n    UserProvider.update(user).then(res => {\n      globalContext.setUser(res);\n\n      _message.success('用户信息已保存');\n    });\n  }, [user, globalContext]);\n\n  const changePassword = () => {\n    if (!oldPassword || !newPassword1 || !newPassword2) {\n      return;\n    }\n\n    if (newPassword1 !== newPassword2) {\n      _message.error('两次密码不一致');\n\n      return;\n    }\n\n    if (newPassword2.length <= 8) {\n      _message.error('密码长度过短');\n\n      return;\n    }\n\n    const data = _objectSpread(_objectSpread({}, user), {}, {\n      oldPassword,\n      newPassword: newPassword2\n    });\n\n    UserProvider.updatePassword(data).then(() => {\n      _message.success('密码已更新，请重新登录');\n\n      Router.replace('/admin/login?redirect=/ownspace');\n    });\n  };\n\n  return __jsx(AdminLayout, null, __jsx(_Row, {\n    gutter: 16,\n    className: styles.wrapper\n  }, __jsx(_Col, {\n    span: 12,\n    md: 12,\n    xs: 24\n  }, __jsx(_List, {\n    style: {\n      backgroundColor: '#fff'\n    },\n    header: '系统概览',\n    dataSource: data,\n    bordered: true,\n    renderItem: item => __jsx(_List.Item, null, __jsx(_Typography.Text, null, item))\n  }), __jsx(FileSelectDrawer, {\n    visible: visible,\n    onClose: () => {\n      setVisible(false);\n    },\n    onChange: url => {\n      setUser(user => {\n        user.avatar = url;\n        return user;\n      });\n      setVisible(false);\n    }\n  })), user && __jsx(_Col, {\n    span: 12,\n    md: 12,\n    xs: 24\n  }, __jsx(_Card, {\n    title: \"\\u4E2A\\u4EBA\\u8D44\\u6599\",\n    bordered: true\n  }, __jsx(_Tabs, {\n    defaultActiveKey: \"1\"\n  }, __jsx(TabPane, {\n    tab: \"\\u57FA\\u672C\\u8BBE\\u7F6E\",\n    key: \"1\"\n  }, __jsx(Form.Item, {\n    labelCol: {\n      xs: 8,\n      sm: 6,\n      md: 4\n    },\n    labelAlign: \"left\"\n  }, __jsx(\"div\", {\n    style: {\n      textAlign: 'center'\n    },\n    onClick: () => {\n      setVisible(true);\n    }\n  }, __jsx(_Avatar, {\n    size: 64,\n    src: user.avatar\n  }))), __jsx(Form.Item, {\n    label: \"\\u7528\\u6237\\u540D\",\n    labelCol: {\n      xs: 8,\n      sm: 6,\n      md: 4\n    },\n    labelAlign: \"left\"\n  }, __jsx(_Input, {\n    placeholder: \"\\u8BF7\\u8F93\\u5165\\u7528\\u6237\\u540D\",\n    defaultValue: user.name,\n    onChange: e => {\n      const value = e.target.value;\n      setUser(user => {\n        user.name = value;\n        return user;\n      });\n    }\n  })), __jsx(Form.Item, {\n    label: \"\\u90AE\\u7BB1\",\n    labelCol: {\n      xs: 8,\n      sm: 6,\n      md: 4\n    },\n    labelAlign: \"left\"\n  }, __jsx(_Input, {\n    placeholder: \"\\u8BF7\\u8F93\\u5165\\u90AE\\u7BB1\",\n    defaultValue: user.email,\n    onChange: e => {\n      const value = e.target.value;\n      const regexp = /^(\\w-*\\.*)+@(\\w-?)+(\\.\\w{2,})+$/;\n\n      if (!regexp.test(value)) {\n        return;\n      }\n\n      setUser(user => {\n        user.email = value;\n        return user;\n      });\n    }\n  })), __jsx(_Button, {\n    type: \"primary\",\n    onClick: save\n  }, \"\\u4FDD\\u5B58\")), __jsx(TabPane, {\n    tab: \"\\u66F4\\u65B0\\u5BC6\\u7801\",\n    key: \"2\"\n  }, __jsx(Form.Item, {\n    label: \"\\u539F\\u5BC6\\u7801\",\n    labelCol: {\n      xs: 8,\n      sm: 6,\n      md: 4\n    },\n    labelAlign: \"left\"\n  }, __jsx(_Input.Password, {\n    placeholder: \"\\u8BF7\\u8F93\\u5165\\u539F\\u5BC6\\u7801\",\n    value: oldPassword,\n    onChange: e => {\n      const value = e.target.value;\n      setOldPassword(value);\n    }\n  })), __jsx(Form.Item, {\n    label: \"\\u65B0\\u5BC6\\u7801\",\n    labelCol: {\n      xs: 8,\n      sm: 6,\n      md: 4\n    },\n    labelAlign: \"left\"\n  }, __jsx(_Input.Password, {\n    placeholder: \"\\u8BF7\\u8F93\\u5165\\u65B0\\u5BC6\\u7801\",\n    value: newPassword1,\n    onChange: e => {\n      const value = e.target.value;\n      setNewPassword1(value);\n    }\n  })), __jsx(Form.Item, {\n    label: \"\\u786E\\u8BA4\\u5BC6\\u7801\",\n    labelCol: {\n      xs: 8,\n      sm: 6,\n      md: 4\n    },\n    labelAlign: \"left\"\n  }, __jsx(_Input.Password, {\n    placeholder: \"\\u8BF7\\u786E\\u8BA4\\u65B0\\u5BC6\\u7801\",\n    value: newPassword2,\n    onChange: e => {\n      const value = e.target.value;\n      setNewPassword2(value);\n    }\n  })), __jsx(_Button, {\n    type: \"primary\",\n    onClick: changePassword\n  }, \"\\u66F4\\u65B0\")))))));\n};\n\nOwnspace.getInitialProps = async () => {\n  const [articles, tags, category, files, comments] = await Promise.all([ArticleProvider.getArticles({\n    page: 1,\n    pageSize: 6\n  }), TagProvider.getTags(), CategoryProvider.getCategory(), FileProvider.getFiles({\n    page: 1,\n    pageSize: 6\n  }), CommentProvider.getComments({\n    page: 1,\n    pageSize: 6\n  })]);\n  return {\n    articlesCount: articles[1],\n    tagsCount: tags.length,\n    categoryCount: category.length,\n    filesCount: files[1],\n    commentsCount: comments[1]\n  };\n};\n\nexport default Ownspace;","map":null,"metadata":{},"sourceType":"module"}