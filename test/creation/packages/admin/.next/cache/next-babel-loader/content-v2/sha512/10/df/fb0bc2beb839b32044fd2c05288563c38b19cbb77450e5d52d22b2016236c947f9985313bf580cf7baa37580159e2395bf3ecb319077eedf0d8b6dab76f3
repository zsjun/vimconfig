{"ast":null,"code":"import \"antd/lib/button/style\";\nimport _Button from \"antd/lib/button\";\nimport \"antd/lib/tabs/style\";\nimport _Tabs from \"antd/lib/tabs\";\nimport \"antd/lib/message/style\";\nimport _message from \"antd/lib/message\";\nimport \"antd/lib/input/style\";\nimport _Input from \"antd/lib/input\";\nimport \"antd/lib/modal/style\";\nimport _Modal from \"antd/lib/modal\";\nvar __jsx = React.createElement;\nimport React, { useState, useEffect, useCallback } from 'react';\nimport { WarningOutlined } from '@ant-design/icons';\nimport { SettingProvider } from '@/providers/setting';\nimport { JsonEditor } from '@/components/JsonEditor';\nimport { useForceUpdate } from '@/hooks/useForceUpdate';\nexport const LocaleSetting = ({\n  setting\n}) => {\n  const forceUpdate = useForceUpdate();\n  const {\n    0: i18n,\n    1: setI18n\n  } = useState({});\n  const locales = i18n && typeof i18n === 'object' ? Object.keys(i18n) : [];\n  useEffect(() => {\n    try {\n      if (setting.i18n) {\n        const json = JSON.parse(setting.i18n);\n        setI18n(json);\n      }\n    } catch (e) {\n      setI18n({});\n    }\n  }, [setting.i18n]);\n  const onEdit = useCallback((key, action) => {\n    const add = () => {\n      let locale = '';\n\n      const onChange = function (e) {\n        locale = e.target.value;\n      };\n\n      _Modal.confirm({\n        title: '请输入语言名称（英文）',\n        // eslint-disable-next-line react/jsx-no-bind\n        icon: __jsx(_Input, {\n          onChange: onChange\n        }),\n\n        onOk() {\n          setI18n(json => {\n            json[locale] = {};\n            return json;\n          });\n          forceUpdate();\n        },\n\n        okText: '确认',\n        cancelText: '取消',\n        transitionName: '',\n        maskTransitionName: ''\n      });\n    };\n\n    const remove = () => {\n      _Modal.confirm({\n        title: '确认删除',\n        icon: __jsx(WarningOutlined, null),\n\n        onOk() {\n          setI18n(json => {\n            delete json[key];\n            return json;\n          });\n          forceUpdate();\n        },\n\n        okText: '确认',\n        cancelText: '取消',\n        transitionName: '',\n        maskTransitionName: ''\n      });\n    };\n\n    if (action === 'add') {\n      add();\n    } else {\n      remove();\n    }\n  }, [forceUpdate]);\n  const onChange = useCallback(locale => {\n    return value => {\n      setI18n(json => {\n        json[locale] = value;\n        return json;\n      });\n    };\n  }, []);\n  const save = useCallback(() => {\n    const data = {\n      i18n: JSON.stringify(i18n)\n    };\n    SettingProvider.updateSetting(data).then(() => {\n      _message.success('保存成功');\n    });\n  }, [i18n]);\n  return __jsx(\"div\", null, __jsx(_Tabs, {\n    type: \"editable-card\",\n    onEdit: onEdit\n  }, locales.map(locale => __jsx(_Tabs.TabPane, {\n    tab: locale,\n    key: locale\n  }, __jsx(JsonEditor, {\n    value: JSON.stringify(i18n[locale], null, 2),\n    onChange: onChange(locale)\n  })))), __jsx(_Button, {\n    type: \"primary\",\n    onClick: save\n  }, \"\\u4FDD\\u5B58\"));\n};","map":null,"metadata":{},"sourceType":"module"}