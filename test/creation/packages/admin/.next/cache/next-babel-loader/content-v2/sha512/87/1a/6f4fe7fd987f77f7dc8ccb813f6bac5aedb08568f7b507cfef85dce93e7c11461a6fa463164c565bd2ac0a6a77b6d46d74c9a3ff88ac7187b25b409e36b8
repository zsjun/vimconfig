{"ast":null,"code":"import _regeneratorRuntime from \"/Users/zsj/work/vimconfig/test/creation/packages/admin/node_modules/@babel/runtime/regenerator\";\nimport _slicedToArray from \"/Users/zsj/work/vimconfig/test/creation/packages/admin/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nimport _asyncToGenerator from \"/Users/zsj/work/vimconfig/test/creation/packages/admin/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport \"antd/lib/list/style\";\nimport _List from \"antd/lib/list\";\nimport \"antd/lib/row/style\";\nimport _Row from \"antd/lib/row\";\nimport \"antd/lib/col/style\";\nimport _Col from \"antd/lib/col\";\nimport \"antd/lib/card/style\";\nimport _Card from \"antd/lib/card\";\nimport \"antd/lib/alert/style\";\nimport _Alert from \"antd/lib/alert\";\nimport \"antd/lib/typography/style\";\nimport _Typography from \"antd/lib/typography\";\nvar __jsx = React.createElement;\nimport React, { useCallback, useState } from 'react';\nimport Link from 'next/link';\nimport { useSetting } from '@/hooks/useSetting';\nimport { useUser } from '@/hooks/useUser';\nimport { AdminLayout } from '@/layout/AdminLayout';\nimport { ArticleProvider } from '@/providers/article';\nimport { CommentProvider } from '@/providers/comment';\nimport { CommentArticle } from '@/components/comment/CommentArticle';\nimport { CommentStatus } from '@/components/comment/CommentStatus';\nimport { CommentAction } from '@/components/comment/CommentAction';\nimport { CommentContent } from '@/components/comment/CommentContent';\nimport style from './index.module.scss';\nimport EchartView from '@/components/EchartView';\nvar Title = _Typography.Title,\n    Paragraph = _Typography.Paragraph;\nvar actions = [{\n  name: '文章管理',\n  url: '/article'\n}, {\n  name: '评论管理',\n  url: '/comment'\n}, {\n  name: '文件管理',\n  url: '/file'\n}, {\n  name: '用户管理',\n  url: '/user'\n}, {\n  name: '访问管理',\n  url: '/view'\n}, {\n  name: '系统设置',\n  url: '/setting'\n}];\nvar pageSize = 6;\n\nvar Home = function Home(_ref) {\n  var _ref$articles = _ref.articles,\n      articles = _ref$articles === void 0 ? [] : _ref$articles,\n      _ref$comments = _ref.comments,\n      defaultComments = _ref$comments === void 0 ? [] : _ref$comments;\n  var setting = useSetting();\n  var user = useUser();\n\n  var _useState = useState(defaultComments),\n      comments = _useState[0],\n      setComments = _useState[1];\n\n  var getComments = useCallback(function () {\n    return CommentProvider.getComments({\n      page: 1,\n      pageSize: pageSize\n    }).then(function (res) {\n      setComments(res[0]);\n      return res;\n    });\n  }, []);\n  return __jsx(AdminLayout, {\n    headerAppender: __jsx(_Typography, null, __jsx(Title, null, \"\\u60A8\\u597D\\uFF0C\", user.name), __jsx(Paragraph, null, \"\\u60A8\\u7684\\u89D2\\u8272\\uFF1A\", user.role === 'admin' ? '管理员' : '访客'))\n  }, !setting || !setting.systemUrl ? __jsx(\"div\", {\n    style: {\n      marginBottom: 24\n    }\n  }, __jsx(_Alert, {\n    message: __jsx(\"span\", null, \"\\u7CFB\\u7EDF\\u68C0\\u6D4B\\u5230\", __jsx(\"strong\", null, \"\\u7CFB\\u7EDF\\u914D\\u7F6E\"), \"\\u672A\\u5B8C\\u5584\\uFF0C\", __jsx(Link, {\n      href: \"/setting?type=\\u7CFB\\u7EDF\\u8BBE\\u7F6E\"\n    }, __jsx(\"a\", null, \"\\u70B9\\u6211\\u7ACB\\u5373\\u5B8C\\u5584\"))),\n    type: \"warning\"\n  })) : null, __jsx(_Card, {\n    title: \"\\u9762\\u677F\\u5BFC\\u822A\",\n    bordered: false,\n    bodyStyle: {\n      padding: 0\n    }\n  }, __jsx(EchartView, {\n    option: {\n      legend: {\n        data: ['评论数', '访问量']\n      },\n      title: {\n        text: '每周用户访问指标',\n        padding: 25\n      },\n      xAxis: {\n        type: 'category',\n        data: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun']\n      },\n      yAxis: {\n        type: 'value'\n      },\n      series: [{\n        name: '评论数',\n        data: [120, 200, 150, 80, 70, 110, 130],\n        type: 'bar'\n      }, {\n        name: '访问量',\n        type: 'line',\n        data: [360, 289, 352, 120, 96, 130, 166]\n      }]\n    }\n  })), __jsx(_Card, {\n    title: \"\\u5FEB\\u901F\\u5BFC\\u822A\",\n    bordered: false,\n    style: {\n      marginTop: 24\n    },\n    bodyStyle: {\n      padding: 0\n    }\n  }, __jsx(_Row, null, actions.map(function (action) {\n    return __jsx(_Col, {\n      key: action.url,\n      span: 4,\n      style: {\n        padding: '2rem 1rem',\n        textAlign: 'center'\n      }\n    }, __jsx(Link, {\n      href: action.url\n    }, __jsx(\"a\", {\n      className: style.recentArticleItem\n    }, __jsx(\"span\", null, action.name))));\n  }))), __jsx(_Card, {\n    title: \"\\u6700\\u65B0\\u6587\\u7AE0\",\n    bordered: false,\n    style: {\n      marginTop: 24\n    },\n    bodyStyle: {\n      padding: 0\n    },\n    extra: __jsx(Link, {\n      href: \"/article\"\n    }, __jsx(\"a\", null, __jsx(\"span\", null, \"\\u5168\\u90E8\\u6587\\u7AE0\")))\n  }, articles.map(function (article) {\n    return __jsx(_Card.Grid, {\n      key: article.id,\n      style: {\n        width: '33.3%',\n        textAlign: 'center'\n      },\n      hoverable: true\n    }, __jsx(Link, {\n      href: \"/article/editor/[id]\",\n      as: \"/article/editor/\" + article.id\n    }, __jsx(\"a\", {\n      className: style.recentArticleItem\n    }, __jsx(\"img\", {\n      width: 120,\n      alt: \"\\u6587\\u7AE0\\u5C01\\u9762\",\n      src: article.cover\n    }), __jsx(\"p\", {\n      className: style.title\n    }, article.title))));\n  })), __jsx(_Card, {\n    title: \"\\u6700\\u65B0\\u8BC4\\u8BBA\",\n    style: {\n      marginTop: 24\n    },\n    bordered: false,\n    extra: __jsx(Link, {\n      href: \"/comment\"\n    }, __jsx(\"a\", null, __jsx(\"span\", null, \"\\u5168\\u90E8\\u8BC4\\u8BBA\")))\n  }, __jsx(_List, {\n    dataSource: comments,\n    renderItem: function renderItem(comment) {\n      return __jsx(_List.Item, {\n        key: comment.id,\n        actions: [__jsx(CommentAction, {\n          key: \"action\",\n          comment: comment,\n          refresh: getComments\n        })]\n      }, __jsx(\"span\", null, comment.name), \" \\u5728 \", __jsx(CommentArticle, {\n        comment: comment\n      }), \" \\u8BC4\\u8BBA\", ' ', __jsx(CommentContent, {\n        comment: comment\n      }), __jsx(CommentStatus, {\n        comment: comment\n      }));\n    }\n  })));\n};\n\nHome.getInitialProps = /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n  var _yield$Promise$all, _yield$Promise$all2, articles, comments;\n\n  return _regeneratorRuntime.wrap(function _callee$(_context) {\n    while (1) {\n      switch (_context.prev = _context.next) {\n        case 0:\n          _context.next = 2;\n          return Promise.all([ArticleProvider.getArticles({\n            page: 1,\n            pageSize: pageSize\n          }), CommentProvider.getComments({\n            page: 1,\n            pageSize: pageSize\n          })]);\n\n        case 2:\n          _yield$Promise$all = _context.sent;\n          _yield$Promise$all2 = _slicedToArray(_yield$Promise$all, 2);\n          articles = _yield$Promise$all2[0];\n          comments = _yield$Promise$all2[1];\n          return _context.abrupt(\"return\", {\n            articles: articles[0],\n            comments: comments[0]\n          });\n\n        case 7:\n        case \"end\":\n          return _context.stop();\n      }\n    }\n  }, _callee);\n}));\nexport default Home;","map":null,"metadata":{},"sourceType":"module"}