{"ast":null,"code":"import _regeneratorRuntime from \"/Users/zsj/work/vimconfig/test/creation/packages/admin/node_modules/@babel/runtime/regenerator\";\nimport _slicedToArray from \"/Users/zsj/work/vimconfig/test/creation/packages/admin/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nimport _asyncToGenerator from \"/Users/zsj/work/vimconfig/test/creation/packages/admin/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport \"antd/lib/row/style\";\nimport _Row from \"antd/lib/row\";\nimport \"antd/lib/card/style\";\nimport _Card from \"antd/lib/card\";\nimport \"antd/lib/button/style\";\nimport _Button from \"antd/lib/button\";\nimport \"antd/lib/input/style\";\nimport _Input from \"antd/lib/input\";\nimport \"antd/lib/avatar/style\";\nimport _Avatar from \"antd/lib/avatar\";\nimport \"antd/lib/col/style\";\nimport _Col from \"antd/lib/col\";\nimport \"antd/lib/list/style\";\nimport _List from \"antd/lib/list\";\nimport \"antd/lib/typography/style\";\nimport _Typography from \"antd/lib/typography\";\nimport _defineProperty from \"/Users/zsj/work/vimconfig/test/creation/packages/admin/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport \"antd/lib/message/style\";\nimport _message from \"antd/lib/message\";\nimport \"antd/lib/tabs/style\";\nimport _Tabs from \"antd/lib/tabs\";\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport React, { useState, useCallback, useContext } from 'react';\nimport { Form } from '@ant-design/compatible';\nimport { default as Router } from 'next/router';\nimport { AdminLayout } from '@/layout/AdminLayout';\nimport { FileSelectDrawer } from '@/components/FileSelectDrawer';\nimport { ArticleProvider } from '@/providers/article';\nimport { CommentProvider } from '@/providers/comment';\nimport { TagProvider } from '@/providers/tag';\nimport { CategoryProvider } from '@/providers/category';\nimport { FileProvider } from '@/providers/file';\nimport { UserProvider } from '@/providers/user';\nimport { GlobalContext } from '@/context/global';\nimport styles from './index.module.scss';\nvar TabPane = _Tabs.TabPane;\n\nvar Ownspace = function Ownspace(_ref) {\n  var _ref$articlesCount = _ref.articlesCount,\n      articlesCount = _ref$articlesCount === void 0 ? 0 : _ref$articlesCount,\n      _ref$tagsCount = _ref.tagsCount,\n      tagsCount = _ref$tagsCount === void 0 ? 0 : _ref$tagsCount,\n      _ref$categoryCount = _ref.categoryCount,\n      categoryCount = _ref$categoryCount === void 0 ? 0 : _ref$categoryCount,\n      _ref$filesCount = _ref.filesCount,\n      filesCount = _ref$filesCount === void 0 ? 0 : _ref$filesCount,\n      _ref$commentsCount = _ref.commentsCount,\n      commentsCount = _ref$commentsCount === void 0 ? 0 : _ref$commentsCount;\n  var data = [\"\\u7D2F\\u8BA1\\u53D1\\u8868\\u4E86 \" + articlesCount + ' 篇文章', \"\\u7D2F\\u8BA1\\u521B\\u5EFA\\u4E86 \" + categoryCount + ' 个分类', \"\\u7D2F\\u8BA1\\u521B\\u5EFA\\u4E86 \" + tagsCount + ' 个标签', \"\\u7D2F\\u8BA1\\u4E0A\\u4F20\\u4E86 \" + filesCount + ' 个文件', \"\\u7D2F\\u8BA1\\u83B7\\u5F97\\u4E86 \" + commentsCount + ' 个评论'];\n  var globalContext = useContext(GlobalContext);\n\n  var _useState = useState(globalContext.user),\n      user = _useState[0],\n      setUser = _useState[1];\n\n  var _useState2 = useState(false),\n      visible = _useState2[0],\n      setVisible = _useState2[1];\n\n  var _useState3 = useState(null),\n      oldPassword = _useState3[0],\n      setOldPassword = _useState3[1];\n\n  var _useState4 = useState(null),\n      newPassword1 = _useState4[0],\n      setNewPassword1 = _useState4[1];\n\n  var _useState5 = useState(null),\n      newPassword2 = _useState5[0],\n      setNewPassword2 = _useState5[1];\n\n  var save = useCallback(function () {\n    UserProvider.update(user).then(function (res) {\n      globalContext.setUser(res);\n\n      _message.success('用户信息已保存');\n    });\n  }, [user, globalContext]);\n\n  var changePassword = function changePassword() {\n    if (!oldPassword || !newPassword1 || !newPassword2) {\n      return;\n    }\n\n    if (newPassword1 !== newPassword2) {\n      _message.error('两次密码不一致');\n\n      return;\n    }\n\n    if (newPassword2.length <= 8) {\n      _message.error('密码长度过短');\n\n      return;\n    }\n\n    var data = _objectSpread(_objectSpread({}, user), {}, {\n      oldPassword: oldPassword,\n      newPassword: newPassword2\n    });\n\n    UserProvider.updatePassword(data).then(function () {\n      _message.success('密码已更新，请重新登录');\n\n      Router.replace('/admin/login?redirect=/ownspace');\n    });\n  };\n\n  return __jsx(AdminLayout, null, __jsx(_Row, {\n    gutter: 16,\n    className: styles.wrapper\n  }, __jsx(_Col, {\n    span: 12,\n    md: 12,\n    xs: 24\n  }, __jsx(_List, {\n    style: {\n      backgroundColor: '#fff'\n    },\n    header: '系统概览',\n    dataSource: data,\n    bordered: true,\n    renderItem: function renderItem(item) {\n      return __jsx(_List.Item, null, __jsx(_Typography.Text, null, item));\n    }\n  }), __jsx(FileSelectDrawer, {\n    visible: visible,\n    onClose: function onClose() {\n      setVisible(false);\n    },\n    onChange: function onChange(url) {\n      setUser(function (user) {\n        user.avatar = url;\n        return user;\n      });\n      setVisible(false);\n    }\n  })), user && __jsx(_Col, {\n    span: 12,\n    md: 12,\n    xs: 24\n  }, __jsx(_Card, {\n    title: \"\\u4E2A\\u4EBA\\u8D44\\u6599\",\n    bordered: true\n  }, __jsx(_Tabs, {\n    defaultActiveKey: \"1\"\n  }, __jsx(TabPane, {\n    tab: \"\\u57FA\\u672C\\u8BBE\\u7F6E\",\n    key: \"1\"\n  }, __jsx(Form.Item, {\n    labelCol: {\n      xs: 8,\n      sm: 6,\n      md: 4\n    },\n    labelAlign: \"left\"\n  }, __jsx(\"div\", {\n    style: {\n      textAlign: 'center'\n    },\n    onClick: function onClick() {\n      setVisible(true);\n    }\n  }, __jsx(_Avatar, {\n    size: 64,\n    src: user.avatar\n  }))), __jsx(Form.Item, {\n    label: \"\\u7528\\u6237\\u540D\",\n    labelCol: {\n      xs: 8,\n      sm: 6,\n      md: 4\n    },\n    labelAlign: \"left\"\n  }, __jsx(_Input, {\n    placeholder: \"\\u8BF7\\u8F93\\u5165\\u7528\\u6237\\u540D\",\n    defaultValue: user.name,\n    onChange: function onChange(e) {\n      var value = e.target.value;\n      setUser(function (user) {\n        user.name = value;\n        return user;\n      });\n    }\n  })), __jsx(Form.Item, {\n    label: \"\\u90AE\\u7BB1\",\n    labelCol: {\n      xs: 8,\n      sm: 6,\n      md: 4\n    },\n    labelAlign: \"left\"\n  }, __jsx(_Input, {\n    placeholder: \"\\u8BF7\\u8F93\\u5165\\u90AE\\u7BB1\",\n    defaultValue: user.email,\n    onChange: function onChange(e) {\n      var value = e.target.value;\n      var regexp = /^(\\w-*\\.*)+@(\\w-?)+(\\.\\w{2,})+$/;\n\n      if (!regexp.test(value)) {\n        return;\n      }\n\n      setUser(function (user) {\n        user.email = value;\n        return user;\n      });\n    }\n  })), __jsx(_Button, {\n    type: \"primary\",\n    onClick: save\n  }, \"\\u4FDD\\u5B58\")), __jsx(TabPane, {\n    tab: \"\\u66F4\\u65B0\\u5BC6\\u7801\",\n    key: \"2\"\n  }, __jsx(Form.Item, {\n    label: \"\\u539F\\u5BC6\\u7801\",\n    labelCol: {\n      xs: 8,\n      sm: 6,\n      md: 4\n    },\n    labelAlign: \"left\"\n  }, __jsx(_Input.Password, {\n    placeholder: \"\\u8BF7\\u8F93\\u5165\\u539F\\u5BC6\\u7801\",\n    value: oldPassword,\n    onChange: function onChange(e) {\n      var value = e.target.value;\n      setOldPassword(value);\n    }\n  })), __jsx(Form.Item, {\n    label: \"\\u65B0\\u5BC6\\u7801\",\n    labelCol: {\n      xs: 8,\n      sm: 6,\n      md: 4\n    },\n    labelAlign: \"left\"\n  }, __jsx(_Input.Password, {\n    placeholder: \"\\u8BF7\\u8F93\\u5165\\u65B0\\u5BC6\\u7801\",\n    value: newPassword1,\n    onChange: function onChange(e) {\n      var value = e.target.value;\n      setNewPassword1(value);\n    }\n  })), __jsx(Form.Item, {\n    label: \"\\u786E\\u8BA4\\u5BC6\\u7801\",\n    labelCol: {\n      xs: 8,\n      sm: 6,\n      md: 4\n    },\n    labelAlign: \"left\"\n  }, __jsx(_Input.Password, {\n    placeholder: \"\\u8BF7\\u786E\\u8BA4\\u65B0\\u5BC6\\u7801\",\n    value: newPassword2,\n    onChange: function onChange(e) {\n      var value = e.target.value;\n      setNewPassword2(value);\n    }\n  })), __jsx(_Button, {\n    type: \"primary\",\n    onClick: changePassword\n  }, \"\\u66F4\\u65B0\")))))));\n};\n\nOwnspace.getInitialProps = /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n  var _yield$Promise$all, _yield$Promise$all2, articles, tags, category, files, comments;\n\n  return _regeneratorRuntime.wrap(function _callee$(_context) {\n    while (1) {\n      switch (_context.prev = _context.next) {\n        case 0:\n          _context.next = 2;\n          return Promise.all([ArticleProvider.getArticles({\n            page: 1,\n            pageSize: 6\n          }), TagProvider.getTags(), CategoryProvider.getCategory(), FileProvider.getFiles({\n            page: 1,\n            pageSize: 6\n          }), CommentProvider.getComments({\n            page: 1,\n            pageSize: 6\n          })]);\n\n        case 2:\n          _yield$Promise$all = _context.sent;\n          _yield$Promise$all2 = _slicedToArray(_yield$Promise$all, 5);\n          articles = _yield$Promise$all2[0];\n          tags = _yield$Promise$all2[1];\n          category = _yield$Promise$all2[2];\n          files = _yield$Promise$all2[3];\n          comments = _yield$Promise$all2[4];\n          return _context.abrupt(\"return\", {\n            articlesCount: articles[1],\n            tagsCount: tags.length,\n            categoryCount: category.length,\n            filesCount: files[1],\n            commentsCount: comments[1]\n          });\n\n        case 10:\n        case \"end\":\n          return _context.stop();\n      }\n    }\n  }, _callee);\n}));\nexport default Ownspace;","map":null,"metadata":{},"sourceType":"module"}