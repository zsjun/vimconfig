{"ast":null,"code":"import \"antd/lib/drawer/style\";\nimport _Drawer from \"antd/lib/drawer\";\nimport \"antd/lib/button/style\";\nimport _Button from \"antd/lib/button\";\nimport \"antd/lib/switch/style\";\nimport _Switch from \"antd/lib/switch\";\nimport \"antd/lib/input/style\";\nimport _Input from \"antd/lib/input\";\nimport \"antd/lib/message/style\";\nimport _message from \"antd/lib/message\";\nimport _slicedToArray from \"/Users/zsj/work/vimconfig/test/creation/packages/admin/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nvar __jsx = React.createElement;\nimport React, { useState, useCallback, useEffect } from 'react';\nimport { useToggle } from '@/hooks/useToggle';\nimport { useAsyncLoading } from '@/hooks/useAsyncLoading';\nimport { KnowledgeProvider } from '@/providers/knowledge';\nimport { FileSelectDrawer } from '@/components/FileSelectDrawer';\nimport { Upload } from '@/components/Upload';\nexport var KnowledgeSettingDrawer = function KnowledgeSettingDrawer(_ref) {\n  var visible = _ref.visible,\n      toggleVisible = _ref.toggleVisible,\n      _ref$book = _ref.book,\n      book = _ref$book === void 0 ? null : _ref$book,\n      onOk = _ref.onOk;\n  var isUpdate = book !== null;\n\n  var _useToggle = useToggle(false),\n      _useToggle2 = _slicedToArray(_useToggle, 2),\n      fileVisible = _useToggle2[0],\n      toggleFileVisible = _useToggle2[1];\n\n  var _useAsyncLoading = useAsyncLoading(KnowledgeProvider.createBook),\n      _useAsyncLoading2 = _slicedToArray(_useAsyncLoading, 2),\n      createBookApi = _useAsyncLoading2[0],\n      createLoading = _useAsyncLoading2[1];\n\n  var _useAsyncLoading3 = useAsyncLoading(KnowledgeProvider.updateKnowledge),\n      _useAsyncLoading4 = _slicedToArray(_useAsyncLoading3, 2),\n      updateBookApi = _useAsyncLoading4[0],\n      updateLoading = _useAsyncLoading4[1];\n\n  var _useState = useState(book && book.title || ''),\n      title = _useState[0],\n      setTitle = _useState[1];\n\n  var _useState2 = useState(book && book.summary || ''),\n      summary = _useState2[0],\n      setSummary = _useState2[1];\n\n  var _useState3 = useState(book && book.isCommentable || true),\n      isCommentable = _useState3[0],\n      setCommentable = _useState3[1];\n\n  var _useState4 = useState(book && book.cover || ''),\n      cover = _useState4[0],\n      setCover = _useState4[1];\n\n  var ok = useCallback(function () {\n    var data = {\n      title: title.trim(),\n      cover: cover,\n      summary: summary.trim(),\n      isCommentable: isCommentable\n    };\n    var promise = isUpdate ? updateBookApi(book.id, data) : createBookApi(data);\n    promise.then(function (res) {\n      _message.success(isUpdate ? '更新成功' : '创建成功');\n\n      toggleVisible();\n      onOk(res);\n    });\n  }, [title, summary, isCommentable, cover, isUpdate, updateBookApi, createBookApi, book, toggleVisible, onOk]);\n  useEffect(function () {\n    setTitle(book && book.title || '');\n    setSummary(book && book.summary || '');\n    setCommentable(book && book.isCommentable || false);\n    setCover(book && book.cover || '');\n  }, [book]);\n  return __jsx(_Drawer, {\n    title: isUpdate ? '更新知识库' : '新建知识库',\n    width: 600,\n    visible: visible,\n    onClose: toggleVisible\n  }, __jsx(\"div\", {\n    className: \"form-item\"\n  }, __jsx(\"label\", {\n    htmlFor: \"title\"\n  }, \"\\u540D\\u79F0\"), __jsx(\"div\", null, __jsx(_Input, {\n    id: \"title\",\n    value: title,\n    onChange: function onChange(e) {\n      return setTitle(e.target.value);\n    }\n  }))), __jsx(\"div\", {\n    className: \"form-item\"\n  }, __jsx(\"label\", {\n    htmlFor: \"summary\"\n  }, \"\\u63CF\\u8FF0\"), __jsx(\"div\", null, __jsx(_Input.TextArea, {\n    autoSize: {\n      minRows: 3,\n      maxRows: 6\n    },\n    id: \"summary\",\n    value: summary,\n    onChange: function onChange(e) {\n      return setSummary(e.target.value);\n    }\n  }))), __jsx(\"div\", {\n    className: \"form-item\"\n  }, __jsx(\"label\", {\n    htmlFor: \"title\"\n  }, \"\\u8BC4\\u8BBA\"), __jsx(\"div\", null, __jsx(_Switch, {\n    checked: isCommentable,\n    onChange: setCommentable\n  }))), __jsx(\"div\", {\n    className: \"form-item\"\n  }, __jsx(\"label\", {\n    htmlFor: \"upload\"\n  }, \"\\u5C01\\u9762\"), __jsx(\"div\", null, __jsx(Upload, {\n    style: {\n      width: '100%',\n      minHeight: 160\n    },\n    onChange: setCover\n  }, cover ? __jsx(\"img\", {\n    src: cover,\n    alt: \"avatar\",\n    style: {\n      width: '100%'\n    }\n  }) : null), __jsx(_Input, {\n    value: cover,\n    style: {\n      marginTop: 12\n    }\n  }), __jsx(_Button, {\n    style: {\n      marginTop: 12\n    },\n    onClick: toggleFileVisible\n  }, \"\\u9009\\u62E9\\u6587\\u4EF6\"), cover && __jsx(_Button, {\n    style: {\n      marginTop: 12,\n      marginLeft: 12\n    },\n    danger: true,\n    onClick: function onClick() {\n      return setCover('');\n    }\n  }, \"\\u79FB\\u9664\"))), __jsx(FileSelectDrawer, {\n    visible: fileVisible,\n    onClose: toggleFileVisible,\n    onChange: function onChange(url) {\n      setCover(url);\n      toggleFileVisible();\n    }\n  }), __jsx(\"div\", {\n    style: {\n      position: 'absolute',\n      bottom: 0,\n      width: '100%',\n      borderTop: '1px solid #e8e8e8',\n      padding: '10px 16px',\n      textAlign: 'right',\n      left: 0,\n      background: '#fff',\n      borderRadius: '0 0 4px 4px'\n    }\n  }, __jsx(_Button, {\n    onClick: toggleVisible\n  }, \"\\u53D6\\u6D88\"), __jsx(_Button, {\n    style: {\n      marginLeft: 8\n    },\n    type: \"primary\",\n    disabled: !title.trim(),\n    loading: isUpdate ? updateLoading : createLoading,\n    onClick: ok\n  }, isUpdate ? '更新' : '创建')));\n};","map":null,"metadata":{},"sourceType":"module"}