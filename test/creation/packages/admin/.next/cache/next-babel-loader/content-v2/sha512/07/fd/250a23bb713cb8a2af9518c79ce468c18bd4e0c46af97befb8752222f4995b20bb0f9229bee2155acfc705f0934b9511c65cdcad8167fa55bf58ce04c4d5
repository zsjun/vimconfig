{"ast":null,"code":"import \"antd/lib/divider/style\";\nimport _Divider from \"antd/lib/divider\";\nimport \"antd/lib/tooltip/style\";\nimport _Tooltip from \"antd/lib/tooltip\";\nimport _slicedToArray from \"/Users/zsj/work/vimconfig/test/creation/packages/admin/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nvar __jsx = React.createElement;\nimport React, { useState, useCallback, useEffect, useRef, useMemo } from 'react';\nimport cls from 'classnames';\nimport { CloseOutlined } from '@ant-design/icons';\nimport { useToggle } from '@/hooks/useToggle';\nimport { DEFAULT_MARKDOWN } from './DefaultMarkdown';\nimport { toolbar } from './toolbar';\nimport { MonacoEditor } from './MonacoEditor';\nimport { Preview } from './Preview';\nimport { confirm } from './utils/modal';\nimport { makeHtml, makeToc } from './utils/markdown';\nimport style from './index.module.scss';\nimport { Toc } from '../Toc';\nvar CACHE_KEY = 'MONACO_CONTENT_STORAGE';\nvar timer;\nexport var Editor = function Editor(_ref) {\n  var _ref$defaultValue = _ref.defaultValue,\n      defaultValue = _ref$defaultValue === void 0 ? DEFAULT_MARKDOWN : _ref$defaultValue,\n      onChange = _ref.onChange;\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  var editorRef = useRef();\n  var editorContainerRef = useRef();\n\n  var _useState = useState(defaultValue),\n      innerValue = _useState[0],\n      setInnerValue = _useState[1];\n\n  var _useState2 = useState('edit'),\n      mode = _useState2[0],\n      setMode = _useState2[1];\n\n  var _useState3 = useState(true),\n      two = _useState3[0],\n      setTwo = _useState3[1];\n\n  var _useState4 = useState(false),\n      saveState = _useState4[0],\n      setSaveState = _useState4[1];\n\n  var _useToggle = useToggle(true),\n      _useToggle2 = _slicedToArray(_useToggle, 2),\n      tocVisible = _useToggle2[0],\n      toggleTocVisible = _useToggle2[1];\n\n  var _useState5 = useState([]),\n      tocs = _useState5[0],\n      setTocs = _useState5[1];\n\n  var _useMemo = useMemo(function () {\n    return [tocVisible ? '80%' : '100%', tocVisible ? '40%' : '50%'];\n  }, [tocVisible]),\n      fullWidth = _useMemo[0],\n      halfWidth = _useMemo[1];\n\n  var toggleMode = useCallback(function () {\n    setMode(function (mode) {\n      return mode === 'preview' ? 'edit' : 'preview';\n    });\n  }, []);\n  var toggleTwo = useCallback(function () {\n    setTwo(function (v) {\n      return !v;\n    });\n  }, []);\n  var toggleSaveState = useCallback(function () {\n    setSaveState(function (v) {\n      var nextValue = !v;\n\n      if (nextValue) {\n        timer = setTimeout(toggleSaveState, 2000);\n      }\n\n      return nextValue;\n    });\n  }, []);\n  var saveCache = useCallback(function (value) {\n    localStorage.setItem(CACHE_KEY, value);\n    toggleSaveState();\n  }, [toggleSaveState]);\n  useEffect(function () {\n    var html = makeHtml(innerValue);\n    var tocs = makeToc(html);\n    setTocs(tocs);\n    onChange({\n      value: innerValue,\n      html: html,\n      toc: JSON.stringify(tocs)\n    });\n  }, [innerValue, onChange]);\n  useEffect(function () {\n    var listener = function listener(evt) {\n      var handle = function handle(value) {\n        setInnerValue(value);\n        editorRef.current && editorRef.current.setValue(value);\n      };\n\n      if (evt.data.id !== 'editor-mounted') {\n        return;\n      }\n\n      var cache = localStorage.getItem(CACHE_KEY);\n\n      if (cache && defaultValue === DEFAULT_MARKDOWN) {\n        confirm().then(function () {\n          return handle(cache);\n        })[\"catch\"](function () {\n          return handle(defaultValue);\n        });\n      } else {\n        handle(defaultValue);\n      }\n\n      window.removeEventListener('message', listener);\n    };\n\n    window.addEventListener('message', listener);\n    return function () {\n      window.removeEventListener('message', listener);\n    };\n  }, [defaultValue]);\n  useEffect(function () {\n    return function () {\n      clearTimeout(timer);\n    };\n  }, []);\n  useEffect(function () {\n    if (!editorRef.current || !editorContainerRef.current) {\n      return;\n    }\n\n    if (!two && mode === 'preview') {\n      return;\n    }\n\n    editorRef.current.layout(editorContainerRef.current.getBoundingClientRect());\n  }, [two, mode, tocVisible]);\n  return __jsx(\"div\", {\n    className: cls(style.wrapper)\n  }, __jsx(\"header\", null, __jsx(\"div\", null, toolbar.map(function (tool) {\n    return __jsx(\"span\", {\n      key: tool.label,\n      className: style.toolWrap,\n      onClick: tool.getAction(editorRef.current)\n    }, __jsx(_Tooltip, {\n      title: tool.label\n    }, __jsx(tool.content, {\n      editor: editorRef.current\n    })));\n  }), __jsx(\"span\", {\n    style: {\n      opacity: saveState ? 1 : 0\n    }\n  }, \"\\u5DF2\\u4FDD\\u5B58\\u5230\\u672C\\u5730\")), __jsx(\"div\", null, __jsx(\"span\", {\n    className: style.modeWrapper\n  }, __jsx(\"span\", null, \"\\u5F53\\u524D\\u6A21\\u5F0F\\uFF1A\"), __jsx(\"span\", {\n    onClick: toggleMode\n  }, mode === 'preview' ? '预览' : '编辑')), __jsx(_Divider, {\n    type: \"vertical\"\n  }), __jsx(\"span\", {\n    onClick: toggleTwo\n  }, two ? '退出' : '', \"\\u4E24\\u680F\\u663E\\u793A\"), __jsx(_Divider, {\n    type: \"vertical\"\n  }), __jsx(\"span\", {\n    onClick: toggleTocVisible\n  }, __jsx(\"span\", null, \"\\u5927\\u7EB2\")))), __jsx(\"main\", null, __jsx(\"div\", {\n    ref: editorContainerRef,\n    style: {\n      width: two ? halfWidth : mode === 'preview' ? 0 : fullWidth,\n      overflow: 'hidden'\n    }\n  }, __jsx(MonacoEditor, {\n    ref: editorRef,\n    defaultValue: defaultValue,\n    onChange: setInnerValue,\n    onSave: saveCache\n  })), __jsx(\"div\", {\n    style: {\n      width: two ? halfWidth : mode === 'edit' ? 0 : fullWidth\n    }\n  }, __jsx(Preview, {\n    value: innerValue\n  })), __jsx(\"div\", {\n    style: {\n      width: tocVisible ? '20%' : 0\n    }\n  }, __jsx(\"div\", {\n    className: style.tocWrapper\n  }, __jsx(\"header\", null, __jsx(\"span\", null, \"\\u5927\\u7EB2\"), __jsx(\"span\", {\n    onClick: toggleTocVisible\n  }, __jsx(CloseOutlined, null))), __jsx(\"main\", null, __jsx(Toc, {\n    tocs: tocs\n  }))))));\n};","map":null,"metadata":{},"sourceType":"module"}