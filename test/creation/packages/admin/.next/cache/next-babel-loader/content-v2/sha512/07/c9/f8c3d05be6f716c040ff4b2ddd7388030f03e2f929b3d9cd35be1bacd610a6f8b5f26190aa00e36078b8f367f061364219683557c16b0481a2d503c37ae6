{"ast":null,"code":"import \"antd/lib/drawer/style\";\nimport _Drawer from \"antd/lib/drawer\";\nimport \"antd/lib/input-number/style\";\nimport _InputNumber from \"antd/lib/input-number\";\nimport \"antd/lib/page-header/style\";\nimport _PageHeader from \"antd/lib/page-header\";\nimport \"antd/lib/dropdown/style\";\nimport _Dropdown from \"antd/lib/dropdown\";\nimport \"antd/lib/menu/style\";\nimport _Menu from \"antd/lib/menu\";\nimport \"antd/lib/input/style\";\nimport _Input from \"antd/lib/input\";\nimport \"antd/lib/popconfirm/style\";\nimport _Popconfirm from \"antd/lib/popconfirm\";\nimport \"antd/lib/button/style\";\nimport _Button from \"antd/lib/button\";\nimport \"antd/lib/modal/style\";\nimport _Modal from \"antd/lib/modal\";\nimport \"antd/lib/message/style\";\nimport _message from \"antd/lib/message\";\nimport _slicedToArray from \"/Users/zsj/work/vimconfig/test/creation/packages/admin/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nvar __jsx = React.createElement;\nimport React, { useState, useCallback, useMemo, useEffect } from 'react';\nimport cls from 'classnames';\nimport { default as Router } from 'next/router';\nimport { Helmet } from 'react-helmet';\nimport { resolveUrl } from '@/utils';\nimport { useToggle } from '@/hooks/useToggle';\nimport { CloseOutlined, EllipsisOutlined, FileImageOutlined } from '@ant-design/icons';\nimport { Editor as CodeEditor } from '@components/Editor';\nimport { FileSelectDrawer } from '@/components/FileSelectDrawer';\nimport { PageProvider } from '@/providers/page';\nimport { useSetting } from '@/hooks/useSetting';\nimport style from './index.module.scss';\n\nvar FormItem = function FormItem(_ref) {\n  var label = _ref.label,\n      content = _ref.content;\n  return __jsx(\"div\", {\n    className: style.formItem\n  }, __jsx(\"span\", null, label), __jsx(\"div\", null, content));\n};\n\nvar drawerFooterStyle = {\n  position: 'absolute',\n  bottom: 0,\n  width: '100%',\n  borderTop: '1px solid #e8e8e8',\n  padding: '10px 16px',\n  textAlign: 'right',\n  left: 0,\n  background: '#fff',\n  borderRadius: '0 0 4px 4px'\n};\nexport var PageEditor = function PageEditor(_ref2) {\n  var defaultId = _ref2.id,\n      _ref2$page = _ref2.page,\n      defaultPage = _ref2$page === void 0 ? {} : _ref2$page;\n  var setting = useSetting();\n  var isCreate = !defaultId; // 一开始是否是新建\n\n  var _useState = useState(defaultId),\n      id = _useState[0],\n      setId = _useState[1];\n\n  var _useState2 = useState(defaultPage),\n      page = _useState2[0],\n      setPage = _useState2[1];\n\n  var _useToggle = useToggle(false),\n      _useToggle2 = _slicedToArray(_useToggle, 2),\n      pageDrawerVisible = _useToggle2[0],\n      togglePageDrawerVisible = _useToggle2[1];\n\n  var _useToggle3 = useToggle(false),\n      _useToggle4 = _slicedToArray(_useToggle3, 2),\n      fileDrawerVisible = _useToggle4[0],\n      toggleFileDrawerVisible = _useToggle4[1];\n\n  var patchPage = useMemo(function () {\n    return function (key) {\n      return function (value) {\n        if (value.target) {\n          value = value.target.value;\n        }\n\n        setPage(function (page) {\n          if (key === 'path') {\n            value = value.replace('/', '');\n          }\n\n          page[key] = value;\n          return page;\n        });\n      };\n    };\n  }, []);\n  var save = useCallback(function () {\n    if (!page.name) {\n      _message.warn('请输入页面名称');\n\n      return;\n    }\n\n    page.status = 'draft';\n    var promise = id ? PageProvider.updatePage(id, page) : PageProvider.addPage(page);\n    promise.then(function (res) {\n      setId(res.id);\n\n      _message.success('页面已保存为草稿');\n    });\n  }, [page, id]);\n  var publish = useCallback(function () {\n    var canPublish = true;\n    void [['name', '请输入页面名称'], ['path', '请输入页面路径'], ['content', '请输入页面内容']].forEach(function (_ref3) {\n      var _ref4 = _slicedToArray(_ref3, 2),\n          key = _ref4[0],\n          msg = _ref4[1];\n\n      if (!page[key]) {\n        _message.warn(msg);\n\n        canPublish = false;\n      }\n    });\n\n    if (!canPublish) {\n      page.name && togglePageDrawerVisible();\n      return;\n    }\n\n    page.status = 'publish';\n\n    if (id) {\n      PageProvider.updatePage(id, page).then(function (res) {\n        setId(res.id);\n\n        _message.success('页面已更新');\n      });\n    } else {\n      PageProvider.addPage(page).then(function (res) {\n        setId(res.id);\n\n        _message.success('页面已发布');\n      });\n    }\n  }, [page, id, togglePageDrawerVisible]);\n  var preview = useCallback(function () {\n    if (id) {\n      window.open(resolveUrl(setting.systemUrl, '/page/' + id));\n    } else {\n      _message.warn('请先保存');\n    }\n  }, [id, setting.systemUrl]);\n  var deletePage = useCallback(function () {\n    if (!id) {\n      return;\n    }\n\n    var handle = function handle() {\n      PageProvider.deletePage(id).then(function () {\n        _message.success('页面删除成功');\n\n        Router.push('/page');\n      });\n    };\n\n    _Modal.confirm({\n      title: '确认删除？',\n      content: '删除内容后，无法恢复。',\n      onOk: handle,\n      okText: '确认',\n      cancelText: '取消',\n      transitionName: '',\n      maskTransitionName: ''\n    });\n  }, [id]);\n  useEffect(function () {\n    if (isCreate && id) {\n      Router.replace('/page/editor/' + id);\n    }\n  }, [isCreate, id]);\n  return __jsx(\"div\", {\n    className: style.wrapper\n  }, __jsx(Helmet, null, __jsx(\"title\", null, id ? \"\\u7F16\\u8F91\\u9875\\u9762 \".concat(page.name ? '-' + page.name : '') : '新建页面')), __jsx(\"header\", {\n    className: style.header\n  }, __jsx(_PageHeader, {\n    style: {\n      borderBottom: '1px solid rgb(235, 237, 240)',\n      background: '#fff'\n    },\n    backIcon: __jsx(_Popconfirm, {\n      title: \"\\u786E\\u8BA4\\u5173\\u95ED\\uFF1F\\u5982\\u679C\\u6709\\u5185\\u5BB9\\u53D8\\u66F4\\uFF0C\\u8BF7\\u5148\\u4FDD\\u5B58\\u3002\",\n      onConfirm: function onConfirm() {\n        return Router.push('/page');\n      },\n      onCancel: function onCancel() {\n        return null;\n      },\n      okText: \"\\u786E\\u8BA4\",\n      cancelText: \"\\u53D6\\u6D88\",\n      placement: \"rightBottom\"\n    }, __jsx(_Button, {\n      size: \"small\",\n      icon: __jsx(CloseOutlined, null)\n    })),\n    onBack: function onBack() {\n      return null;\n    },\n    title: __jsx(_Input, {\n      style: {\n        width: 300\n      },\n      placeholder: \"\\u8BF7\\u8F93\\u5165\\u9875\\u9762\\u540D\\u79F0\",\n      defaultValue: page.name,\n      onChange: patchPage('name')\n    }),\n    extra: [__jsx(_Button, {\n      key: \"publish\",\n      type: \"primary\",\n      onClick: publish\n    }, \"\\u53D1\\u5E03\"), __jsx(_Dropdown, {\n      key: \"more\",\n      overlay: __jsx(_Menu, null, __jsx(_Menu.Item, {\n        disabled: isCreate,\n        key: \"preview\",\n        onClick: preview\n      }, \"\\u67E5\\u770B\"), __jsx(_Menu.Item, {\n        key: \"setting\",\n        onClick: togglePageDrawerVisible\n      }, \"\\u8BBE\\u7F6E\"), __jsx(_Menu.Divider, null), __jsx(_Menu.Item, {\n        key: \"draft\",\n        onClick: save\n      }, \"\\u4FDD\\u5B58\\u8349\\u7A3F\"), __jsx(_Menu.Divider, null), __jsx(_Menu.Item, {\n        disabled: isCreate,\n        key: \"delete\",\n        onClick: deletePage\n      }, \"\\u5220\\u9664\"))\n    }, __jsx(_Button, {\n      icon: __jsx(EllipsisOutlined, null),\n      type: \"link\"\n    }))]\n  })), __jsx(\"main\", {\n    className: cls(style.main)\n  }, __jsx(CodeEditor, {\n    defaultValue: page.content,\n    onChange: function onChange(_ref5) {\n      var value = _ref5.value,\n          html = _ref5.html,\n          toc = _ref5.toc;\n      patchPage('content')(value);\n      patchPage('html')(html);\n      patchPage('toc')(toc);\n    }\n  })), __jsx(_Drawer, {\n    title: '页面属性',\n    width: 480,\n    visible: pageDrawerVisible,\n    onClose: togglePageDrawerVisible\n  }, __jsx(FormItem, {\n    label: \"\\u5C01\\u9762\",\n    content: __jsx(_Input, {\n      placeholder: \"\\u8BF7\\u8F93\\u5165\\u9875\\u9762\\u5C01\\u9762\",\n      addonAfter: __jsx(FileImageOutlined, {\n        onClick: toggleFileDrawerVisible\n      }),\n      defaultValue: page.cover,\n      onChange: patchPage('cover')\n    })\n  }), __jsx(FormItem, {\n    label: \"\\u8DEF\\u5F84\",\n    content: __jsx(_Input, {\n      placeholder: \"\\u8BF7\\u914D\\u7F6E\\u9875\\u9762\\u8DEF\\u5F84\",\n      defaultValue: page.path,\n      onChange: patchPage('path')\n    })\n  }), __jsx(FormItem, {\n    label: \"\\u987A\\u5E8F\",\n    content: __jsx(_InputNumber, {\n      defaultValue: page.order || 0,\n      onChange: patchPage('order')\n    })\n  }), __jsx(\"div\", {\n    style: drawerFooterStyle\n  }, __jsx(_Button, {\n    type: \"primary\",\n    onClick: togglePageDrawerVisible\n  }, \"\\u786E\\u8BA4\"))), __jsx(FileSelectDrawer, {\n    isCopy: true,\n    closeAfterClick: true,\n    visible: fileDrawerVisible,\n    onClose: toggleFileDrawerVisible\n  }));\n};","map":null,"metadata":{},"sourceType":"module"}