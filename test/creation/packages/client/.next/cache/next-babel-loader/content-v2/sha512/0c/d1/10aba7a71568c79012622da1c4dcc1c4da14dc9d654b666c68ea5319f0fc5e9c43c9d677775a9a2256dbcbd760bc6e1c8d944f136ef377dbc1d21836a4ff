{"ast":null,"code":"var __jsx = React.createElement;\nimport React, { useState, useCallback, useEffect, useContext } from 'react';\nimport { useTranslations } from 'next-intl';\nimport InfiniteScroll from 'react-infinite-scroller';\nimport { ArticleProvider } from '@/providers/article';\nimport { CategoryProvider } from '@/providers/category';\nimport { GlobalContext } from '@/context/global';\nimport { DoubleColumnLayout } from '@/layout/DoubleColumnLayout';\nimport { Footer } from '@components/Footer';\nimport { ArticleList } from '@components/ArticleList';\nimport { ArticleRecommend } from '@/components/ArticleRecommend';\nimport { Tags } from '@components/Tags';\nimport { CategoryMenu } from '../index';\nimport style from '../index.module.scss';\nconst pageSize = 12;\n\nconst Home = ({\n  articles: defaultArticles = [],\n  total,\n  category\n}) => {\n  const t = useTranslations();\n  const {\n    setting,\n    tags,\n    categories\n  } = useContext(GlobalContext);\n  const {\n    0: page,\n    1: setPage\n  } = useState(1);\n  const {\n    0: articles,\n    1: setArticles\n  } = useState(defaultArticles);\n  useEffect(() => {\n    setArticles(defaultArticles);\n  }, [defaultArticles]);\n  const getArticles = useCallback(page => {\n    ArticleProvider.getArticlesByCategory(category.value, {\n      page,\n      pageSize,\n      status: 'publish'\n    }).then(res => {\n      setPage(page);\n      setArticles(articles => [...articles, ...res[0]]);\n    });\n  }, [category]);\n  return __jsx(\"div\", {\n    className: style.wrapper\n  }, __jsx(DoubleColumnLayout, {\n    leftNode: __jsx(React.Fragment, null, __jsx(\"div\", {\n      className: style.tagOrCategoryDetail\n    }, __jsx(\"p\", null, __jsx(\"span\", null, category && category.label), \" \", t('categoryArticle')), __jsx(\"p\", null, t('totalSearch'), \" \", __jsx(\"span\", null, total), \" \", t('piece'))), __jsx(\"div\", {\n      className: style.leftWrap\n    }, __jsx(\"header\", null, __jsx(CategoryMenu, {\n      categories: categories\n    })), __jsx(\"main\", null, __jsx(InfiniteScroll, {\n      pageStart: 1,\n      loadMore: getArticles,\n      hasMore: page * pageSize < total,\n      loader: __jsx(\"div\", {\n        className: 'loading',\n        key: 0\n      }, t('gettingArticle'))\n    }, __jsx(ArticleList, {\n      articles: articles\n    }))))),\n    rightNode: __jsx(\"div\", {\n      className: \"sticky\"\n    }, __jsx(ArticleRecommend, {\n      mode: \"inline\"\n    }), __jsx(Tags, {\n      tags: tags\n    }))\n  }), __jsx(Footer, {\n    setting: setting\n  }));\n}; // 服务端预取数据\n\n\nHome.getInitialProps = async ctx => {\n  const {\n    category: categoryValue\n  } = ctx.query;\n  const [articles, category] = await Promise.all([ArticleProvider.getArticlesByCategory(categoryValue, {\n    page: 1,\n    pageSize,\n    status: 'publish'\n  }), CategoryProvider.getCategoryById(categoryValue)]);\n  return {\n    articles: articles[0],\n    total: articles[1],\n    category: category,\n    needLayoutFooter: false\n  };\n};\n\nexport default Home;","map":null,"metadata":{},"sourceType":"module"}