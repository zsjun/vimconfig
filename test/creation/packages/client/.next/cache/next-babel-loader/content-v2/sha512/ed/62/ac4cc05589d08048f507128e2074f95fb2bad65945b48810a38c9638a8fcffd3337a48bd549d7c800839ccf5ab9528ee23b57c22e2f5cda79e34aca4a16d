{"ast":null,"code":"import _regeneratorRuntime from \"/Users/zsj/work/vimconfig/test/creation/packages/client/node_modules/@babel/runtime/regenerator\";\nimport _slicedToArray from \"/Users/zsj/work/vimconfig/test/creation/packages/client/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nimport _asyncToGenerator from \"/Users/zsj/work/vimconfig/test/creation/packages/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _extends from \"/Users/zsj/work/vimconfig/test/creation/packages/client/node_modules/@babel/runtime/helpers/esm/extends\";\nimport _defineProperty from \"/Users/zsj/work/vimconfig/test/creation/packages/client/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport _toConsumableArray from \"/Users/zsj/work/vimconfig/test/creation/packages/client/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nvar __jsx = React.createElement;\nimport React, { useState, useCallback, useEffect, useContext } from 'react';\nimport cls from 'classnames';\nimport Link from 'next/link';\nimport { useTranslations } from 'next-intl';\nimport { useRouter } from 'next/router';\nimport InfiniteScroll from 'react-infinite-scroller';\nimport { GlobalContext } from '@/context/global';\nimport { DoubleColumnLayout } from '@/layout/DoubleColumnLayout';\nimport { ArticleProvider } from '@/providers/article';\nimport { ArticleList } from '@components/ArticleList';\nimport { ArticleCarousel } from '@components/ArticleCarousel';\nimport { ArticleRecommend } from '@/components/ArticleRecommend';\nimport { Tags } from '@components/Tags';\nimport { Footer } from '@components/Footer';\nimport style from './index.module.scss';\nvar pageSize = 12;\nexport var CategoryMenu = function CategoryMenu(_ref) {\n  var categories = _ref.categories;\n  var t = useTranslations();\n  var router = useRouter();\n  var asPath = router.asPath;\n  return __jsx(React.Fragment, null, [{\n    label: t('all'),\n    path: '/'\n  }].concat(_toConsumableArray(categories)).map(function (category, index) {\n    return __jsx(Link, _extends({\n      key: index\n    }, index === 0 ? {\n      href: '/'\n    } : {\n      href: '/category/[category]',\n      as: \"/category/\" + category.value\n    }, {\n      shallow: false\n    }), __jsx(\"a\", {\n      className: cls(_defineProperty({}, style.active, index === 0 ? asPath === category.path : asPath.replace('/category/', '') === category.value))\n    }, __jsx(\"span\", null, category.label)));\n  }));\n};\n\nvar Home = function Home(_ref2) {\n  var _ref2$articles = _ref2.articles,\n      defaultArticles = _ref2$articles === void 0 ? [] : _ref2$articles,\n      _ref2$recommendedArti = _ref2.recommendedArticles,\n      recommendedArticles = _ref2$recommendedArti === void 0 ? [] : _ref2$recommendedArti,\n      _ref2$total = _ref2.total,\n      total = _ref2$total === void 0 ? 0 : _ref2$total;\n  var t = useTranslations();\n\n  var _useContext = useContext(GlobalContext),\n      setting = _useContext.setting,\n      tags = _useContext.tags,\n      categories = _useContext.categories;\n\n  var _useState = useState(1),\n      page = _useState[0],\n      setPage = _useState[1];\n\n  var _useState2 = useState(defaultArticles),\n      articles = _useState2[0],\n      setArticles = _useState2[1];\n\n  useEffect(function () {\n    setArticles(defaultArticles);\n  }, [defaultArticles]);\n  var getArticles = useCallback(function (page) {\n    ArticleProvider.getArticles({\n      page: page,\n      pageSize: pageSize,\n      status: 'publish'\n    }).then(function (res) {\n      setPage(page);\n      setArticles(function (articles) {\n        return [].concat(_toConsumableArray(articles), _toConsumableArray(res[0]));\n      });\n    });\n  }, []);\n  return __jsx(\"div\", {\n    className: style.wrapper\n  }, __jsx(DoubleColumnLayout, {\n    leftNode: __jsx(React.Fragment, null, __jsx(\"div\", {\n      className: style.crouselWrap\n    }, __jsx(ArticleCarousel, {\n      articles: recommendedArticles\n    })), __jsx(\"div\", {\n      className: style.leftWrap\n    }, __jsx(\"header\", null, __jsx(CategoryMenu, {\n      categories: categories\n    })), __jsx(\"main\", null, __jsx(InfiniteScroll, {\n      pageStart: 1,\n      loadMore: getArticles,\n      hasMore: page * pageSize < total,\n      loader: __jsx(\"div\", {\n        className: 'loading',\n        key: 0\n      }, t('gettingArticle'))\n    }, __jsx(ArticleList, {\n      articles: articles\n    }))))),\n    rightNode: __jsx(\"div\", {\n      className: \"sticky\"\n    }, __jsx(ArticleRecommend, {\n      mode: \"inline\"\n    }), __jsx(Tags, {\n      tags: tags\n    }))\n  }), __jsx(Footer, {\n    setting: setting\n  }));\n}; // 服务端预取数据\n\n\nHome.getInitialProps = /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n  var _yield$Promise$all, _yield$Promise$all2, articles, recommendedArticles;\n\n  return _regeneratorRuntime.wrap(function _callee$(_context) {\n    while (1) {\n      switch (_context.prev = _context.next) {\n        case 0:\n          _context.next = 2;\n          return Promise.all([ArticleProvider.getArticles({\n            page: 1,\n            pageSize: pageSize,\n            status: 'publish'\n          }), ArticleProvider.getAllRecommendArticles()[\"catch\"](function () {\n            return [];\n          })]);\n\n        case 2:\n          _yield$Promise$all = _context.sent;\n          _yield$Promise$all2 = _slicedToArray(_yield$Promise$all, 2);\n          articles = _yield$Promise$all2[0];\n          recommendedArticles = _yield$Promise$all2[1];\n          return _context.abrupt(\"return\", {\n            articles: articles[0],\n            total: articles[1],\n            recommendedArticles: recommendedArticles,\n            needLayoutFooter: false\n          });\n\n        case 7:\n        case \"end\":\n          return _context.stop();\n      }\n    }\n  }, _callee);\n}));\nexport default Home;","map":null,"metadata":{},"sourceType":"module"}