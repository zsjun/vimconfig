{"ast":null,"code":"import _regeneratorRuntime from \"/Users/zsj/work/vimconfig/test/creation/packages/client/node_modules/@babel/runtime/regenerator\";\nimport _slicedToArray from \"/Users/zsj/work/vimconfig/test/creation/packages/client/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nimport _asyncToGenerator from \"/Users/zsj/work/vimconfig/test/creation/packages/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _toConsumableArray from \"/Users/zsj/work/vimconfig/test/creation/packages/client/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nvar __jsx = React.createElement;\nimport React, { useState, useCallback, useEffect, useContext } from 'react';\nimport { useTranslations } from 'next-intl';\nimport InfiniteScroll from 'react-infinite-scroller';\nimport { GlobalContext } from '@/context/global';\nimport { DoubleColumnLayout } from '@/layout/DoubleColumnLayout';\nimport { KnowledgeProvider } from '@/providers/knowledge';\nimport { KnowledgeList } from '@components/KnowledgeList';\nimport { Categories } from '@components/Categories';\nimport { ArticleRecommend } from '@/components/ArticleRecommend';\nvar pageSize = 12;\n\nvar Page = function Page(_ref) {\n  var _ref$books = _ref.books,\n      defaultBooks = _ref$books === void 0 ? [] : _ref$books,\n      _ref$total = _ref.total,\n      total = _ref$total === void 0 ? 0 : _ref$total;\n\n  var _useContext = useContext(GlobalContext),\n      categories = _useContext.categories;\n\n  var t = useTranslations();\n\n  var _useState = useState(1),\n      page = _useState[0],\n      setPage = _useState[1];\n\n  var _useState2 = useState(defaultBooks),\n      books = _useState2[0],\n      setBooks = _useState2[1];\n\n  useEffect(function () {\n    setBooks(defaultBooks);\n  }, [defaultBooks]);\n  var getArticles = useCallback(function (page) {\n    KnowledgeProvider.getKnowledges({\n      page: page,\n      pageSize: pageSize,\n      status: 'publish'\n    }).then(function (res) {\n      setPage(page);\n      setBooks(function (articles) {\n        return [].concat(_toConsumableArray(articles), _toConsumableArray(res[0]));\n      });\n    });\n  }, []);\n  return __jsx(DoubleColumnLayout, {\n    leftNode: __jsx(InfiniteScroll, {\n      pageStart: 1,\n      loadMore: getArticles,\n      hasMore: page * pageSize < total,\n      loader: __jsx(\"div\", {\n        className: 'loading',\n        key: 0\n      }, t('gettingKnowledge'))\n    }, __jsx(KnowledgeList, {\n      knowledges: books\n    })),\n    rightNode: __jsx(\"div\", {\n      className: 'sticky'\n    }, __jsx(ArticleRecommend, {\n      mode: \"inline\"\n    }), __jsx(Categories, {\n      categories: categories\n    }))\n  });\n}; // 服务端预取数据\n\n\nPage.getInitialProps = /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n  var _yield$KnowledgeProvi, _yield$KnowledgeProvi2, books, total;\n\n  return _regeneratorRuntime.wrap(function _callee$(_context) {\n    while (1) {\n      switch (_context.prev = _context.next) {\n        case 0:\n          _context.next = 2;\n          return KnowledgeProvider.getKnowledges({\n            page: 1,\n            pageSize: pageSize,\n            status: 'publish'\n          });\n\n        case 2:\n          _yield$KnowledgeProvi = _context.sent;\n          _yield$KnowledgeProvi2 = _slicedToArray(_yield$KnowledgeProvi, 2);\n          books = _yield$KnowledgeProvi2[0];\n          total = _yield$KnowledgeProvi2[1];\n          return _context.abrupt(\"return\", {\n            books: books,\n            total: total\n          });\n\n        case 7:\n        case \"end\":\n          return _context.stop();\n      }\n    }\n  }, _callee);\n}));\nexport default Page;","map":null,"metadata":{},"sourceType":"module"}