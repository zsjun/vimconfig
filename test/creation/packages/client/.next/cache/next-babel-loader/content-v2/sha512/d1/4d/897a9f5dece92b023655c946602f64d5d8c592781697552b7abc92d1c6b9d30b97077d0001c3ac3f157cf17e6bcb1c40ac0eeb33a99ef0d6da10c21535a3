{"ast":null,"code":"import \"antd/lib/input/style\";\nimport _Input from \"antd/lib/input\";\nvar __jsx = React.createElement;\nimport React, { useState, useCallback, useEffect, useRef } from 'react';\nimport { CloseOutlined } from '@ant-design/icons';\nimport Link from 'next/link';\nimport { useTranslations } from 'next-intl';\nimport { useAsyncLoading } from '@/hooks/useAsyncLoading';\nimport { SearchProvider } from '@/providers/search';\nimport { Spring } from '@/components/Animation/Spring';\nimport { ListTrail } from '@/components/Animation/Trail';\nimport styles from './index.module.scss';\nconst {\n  Search: AntdSearch\n} = _Input;\nexport const Search = ({\n  visible = true,\n  onClose\n}) => {\n  const ref = useRef(null);\n  const t = useTranslations();\n  const [searchArticles, loading] = useAsyncLoading(SearchProvider.searchArticles);\n  const {\n    0: articles,\n    1: setArticles\n  } = useState([]);\n  const close = useCallback(() => {\n    document.body.style.overflow = '';\n    document.body.style.width = '';\n    setArticles([]);\n    onClose(false);\n  }, [onClose]);\n  const getArticles = useCallback(keyword => {\n    if (!keyword) {\n      setArticles([]);\n      return;\n    }\n\n    searchArticles(keyword).then(res => {\n      const ret = res.filter(r => r.status === 'publish' && !r.needPassword);\n      setArticles(ret);\n    });\n  }, [searchArticles]);\n  useEffect(() => {\n    const listener = e => {\n      if (e.which === 27 || e.keyCode === 27) {\n        close();\n      }\n    };\n\n    document.body.addEventListener('keydown', listener);\n    return () => {\n      document.body.removeEventListener('keydown', listener);\n    };\n  }, [close]);\n  useEffect(() => {\n    if (!visible || !ref.current) {\n      return;\n    }\n\n    ref.current.focus();\n    document.body.style.overflow = 'hidden';\n    document.body.style.width = 'calc(100% - 6px)';\n  }, [visible]);\n\n  if (!visible) {\n    return null;\n  }\n\n  return __jsx(\"div\", {\n    className: styles.wrapper\n  }, __jsx(Spring, {\n    from: {\n      y: 20\n    },\n    to: {\n      y: 0\n    }\n  }, __jsx(\"div\", {\n    className: \"container\"\n  }, __jsx(\"header\", null, __jsx(\"span\", {\n    className: styles.title\n  }, t('searchArticle')), __jsx(\"span\", {\n    className: styles.btnWrapper,\n    onClick: close\n  }, __jsx(CloseOutlined, null), __jsx(\"span\", null, \"esc\"))), __jsx(\"section\", null, __jsx(AntdSearch, {\n    ref: ref,\n    size: \"large\",\n    loading: loading,\n    placeholder: t('searchArticlePlaceholder'),\n    onSearch: getArticles,\n    style: {\n      width: '100%'\n    }\n  })), __jsx(\"section\", null, __jsx(\"ul\", null, __jsx(ListTrail, {\n    length: articles.length,\n    options: {\n      config: {\n        mass: 1,\n        tension: 180,\n        friction: 12,\n        clamp: true\n      },\n      opacity: loading ? 0 : 1,\n      height: loading ? 0 : 48,\n      from: {\n        opacity: 0,\n        height: 0\n      }\n    },\n    renderItem: index => {\n      const article = articles[index];\n      return __jsx(Link, {\n        key: article.id,\n        href: `/article/[id]`,\n        as: `/article/${article.id}`,\n        scroll: false\n      }, __jsx(\"a\", {\n        className: styles.item,\n        onClick: close\n      }, article.title));\n    }\n  }))))));\n};","map":null,"metadata":{},"sourceType":"module"}