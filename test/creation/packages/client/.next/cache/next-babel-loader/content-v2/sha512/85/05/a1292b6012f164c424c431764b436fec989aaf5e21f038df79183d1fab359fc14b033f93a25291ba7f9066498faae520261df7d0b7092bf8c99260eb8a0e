{"ast":null,"code":"import \"antd/lib/modal/style\";\nimport _Modal from \"antd/lib/modal\";\nimport _regeneratorRuntime from \"/Users/zsj/work/vimconfig/test/creation/packages/client/node_modules/@babel/runtime/regenerator\";\nimport \"antd/lib/message/style\";\nimport _message from \"antd/lib/message\";\nimport _asyncToGenerator from \"/Users/zsj/work/vimconfig/test/creation/packages/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _slicedToArray from \"/Users/zsj/work/vimconfig/test/creation/packages/client/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nvar __jsx = React.createElement;\nimport React, { useContext, useMemo, useRef, useEffect } from 'react';\nimport { useTranslations } from 'next-intl';\nimport { PosterProvider } from '@/providers/poster';\nimport { GlobalContext } from '@/context/global';\nimport style from './index.module.scss';\nimport { useToggle } from '@/hooks/useToggle';\nimport { download, getDocumentScrollTop } from '@/utils';\n\nvar urllib = require('url');\n\nvar QRCode = require('qrcode-svg');\n\nexport var Share = function Share(_ref) {\n  var cover = _ref.cover,\n      title = _ref.title,\n      desc = _ref.desc,\n      url = _ref.url,\n      children = _ref.children;\n  var t = useTranslations('shareNamespace');\n  var ref = useRef(null);\n\n  var _useContext = useContext(GlobalContext),\n      setting = _useContext.setting,\n      locale = _useContext.locale;\n\n  var systemUrl = setting.systemUrl || '';\n\n  var _useToggle = useToggle(false),\n      _useToggle2 = _slicedToArray(_useToggle, 2),\n      loading = _useToggle2[0],\n      toggleLoading = _useToggle2[1];\n\n  var _useToggle3 = useToggle(false),\n      _useToggle4 = _slicedToArray(_useToggle3, 2),\n      visible = _useToggle4[0],\n      toggleVisible = _useToggle4[1];\n\n  var fullUrl = useMemo(function () {\n    return urllib.resolve(systemUrl, url);\n  }, [systemUrl, url]);\n  var qrcode = useMemo(function () {\n    return new QRCode({\n      content: fullUrl,\n      padding: 0,\n      width: 80,\n      height: 80,\n      color: '#000000',\n      background: '#ffffff'\n    });\n  }, [fullUrl]);\n\n  var save = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(e) {\n      var node, target, hide, ret;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              e.preventDefault();\n              e.nativeEvent.stopImmediatePropagation();\n              e.stopPropagation();\n              toggleLoading();\n              node = ref.current;\n              target = node.firstChild;\n              hide = _message.loading(t('createingPoster'), 0);\n              _context.prev = 7;\n              _context.next = 10;\n              return PosterProvider.createPoster({\n                name: \"\".concat(locale, \"-\").concat(title),\n                html: node.innerHTML,\n                width: target.offsetWidth + 16,\n                height: target.offsetHeight,\n                pageUrl: location.pathname\n              });\n\n            case 10:\n              ret = _context.sent;\n\n              _message.success(t('createdPosterSuccess'));\n\n              download(ret);\n              _context.next = 18;\n              break;\n\n            case 15:\n              _context.prev = 15;\n              _context.t0 = _context[\"catch\"](7);\n\n              _message.error(t('createdPosterError'));\n\n            case 18:\n              _context.prev = 18;\n              toggleLoading();\n              hide();\n              return _context.finish(18);\n\n            case 22:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, null, [[7, 15, 18, 22]]);\n    }));\n\n    return function save(_x) {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  var content = // 以下的内联样式，请勿修改，将用于服务端海报生成\n  __jsx(\"div\", {\n    ref: ref,\n    className: style.wrapper\n  }, __jsx(\"div\", {\n    style: {\n      width: 375,\n      background: '#fff',\n      overflow: 'hidden'\n    },\n    ref: ref\n  }, __jsx(\"div\", null, cover && __jsx(\"img\", {\n    style: {\n      width: '100%',\n      borderRadius: '2px',\n      objectFit: 'cover'\n    },\n    src: cover\n  }), __jsx(\"div\", {\n    style: {\n      minWidth: 225,\n      padding: '12px 0',\n      border: 0,\n      marginBottom: 0,\n      color: 'rgba(0, 0, 0, 0.85)',\n      overflow: 'hidden',\n      fontWeight: 600,\n      fontSize: '16px',\n      lineHeight: '22px'\n    }\n  }, title), __jsx(\"div\", {\n    style: {\n      display: '-webkit-box',\n      maxWidth: '100%',\n      padding: '0 0 12px',\n      color: 'rgba(0, 0, 0, 0.65)',\n      fontSize: 14\n    }\n  }, desc)), __jsx(\"div\", {\n    style: {\n      position: 'relative',\n      height: 80\n    }\n  }, __jsx(\"div\", {\n    style: {\n      position: 'absolute',\n      left: 0,\n      width: 80,\n      height: 80,\n      padding: 0\n    },\n    dangerouslySetInnerHTML: {\n      __html: qrcode.svg()\n    }\n  }), __jsx(\"div\", {\n    style: {\n      position: 'absolute',\n      left: 80,\n      padding: '8px 16px',\n      width: 295,\n      height: 80\n    }\n  }, __jsx(\"p\", {\n    style: {\n      position: 'absolute',\n      top: 0,\n      width: '100%',\n      color: 'rgba(0, 0, 0, 0.85)'\n    }\n  }, t('qrcode')), __jsx(\"p\", {\n    style: {\n      position: 'absolute',\n      bottom: 0,\n      color: 'rgba(0, 0, 0, 0.65)',\n      fontSize: '0.9em'\n    }\n  }, t('shareFrom'), ' ', __jsx(\"a\", {\n    style: {\n      color: '#ff0064'\n    },\n    href: fullUrl\n  }, setting.systemTitle))))));\n\n  useEffect(function () {\n    var handler = function handler() {\n      var y = getDocumentScrollTop();\n\n      if (visible && y > 50) {\n        toggleVisible(false);\n      }\n    };\n\n    document.addEventListener('scroll', handler);\n    return function () {\n      document.removeEventListener('scroll', handler);\n    };\n  }, [visible, toggleVisible]);\n  return __jsx(React.Fragment, null, __jsx(_Modal, {\n    title: t('title'),\n    width: 400,\n    visible: visible,\n    bodyStyle: {\n      display: 'flex',\n      justifyContent: 'center',\n      overflowX: 'hidden'\n    },\n    onCancel: function onCancel(e) {\n      e.preventDefault();\n      e.nativeEvent.stopImmediatePropagation();\n      e.stopPropagation();\n      toggleVisible(false);\n    },\n    onOk: save,\n    okText: \"\\u4E0B\\u8F7D\",\n    cancelText: \"\\u5173\\u95ED\",\n    okButtonProps: {\n      loading: loading\n    },\n    maskClosable: false,\n    transitionName: '',\n    maskTransitionName: ''\n  }, content), __jsx(\"span\", {\n    onClickCapture: function onClickCapture(e) {\n      e.preventDefault();\n      e.nativeEvent.stopImmediatePropagation();\n      e.stopPropagation();\n      toggleVisible();\n    }\n  }, children || __jsx(\"div\", {\n    className: style.iconWrap\n  }, __jsx(\"svg\", {\n    viewBox: \"0 0 1024 1024\",\n    version: \"1.1\",\n    xmlns: \"http://www.w3.org/2000/svg\",\n    width: \"1em\",\n    height: \"1em\"\n  }, __jsx(\"path\", {\n    d: \"M753.607 584.7c-48.519 0-91.596 23.298-118.66 59.315l-233.123-116.96c3.684-12.936 5.657-26.591 5.657-40.71 0-15.465-2.369-30.374-6.76-44.391l232.241-116.52c26.916 37.549 70.919 62.017 120.644 62.017 81.926 0 148.34-66.412 148.34-148.34 0-81.926-66.413-148.34-148.34-148.34-81.927 0-148.34 66.413-148.34 148.34 0 5.668 0.33 11.258 0.948 16.762l-244.945 122.892c-26.598-25.259-62.553-40.762-102.129-40.762-81.926 0-148.34 66.412-148.34 148.34s66.413 148.34 148.34 148.34c41.018 0 78.144-16.648 104.997-43.555l242.509 121.668c-0.904 6.621-1.382 13.374-1.382 20.242 0 81.927 66.412 148.34 148.34 148.34s148.34-66.413 148.34-148.34c-0.001-81.925-66.409-148.339-148.336-148.339l0 0z\",\n    fill: \"currentColor\"\n  })))));\n};","map":null,"metadata":{},"sourceType":"module"}